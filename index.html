<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방명록</title>
</head>
<body>
    <h1>방명록</h1>
    <form id="guestbook-form">
        <input type="text" id="name" placeholder="이름" required>
        <textarea id="message" placeholder="메시지" required></textarea>
        <button type="submit">작성하기</button>
    </form>
    <h2>방명록 목록</h2>
    <ul id="guestbook-entries"></ul>

    <!-- Firebase SDK 로드 (ES 모듈 방식) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Firebase 설정
        const firebaseConfig = {
          apiKey: "AIzaSyBEY3a6nzR9Dl-FxPcSf2EwxcIgkrnhkzs",
  authDomain: "marry-15ccc.firebaseapp.com",
  databaseURL: "https://marry-15ccc-default-rtdb.firebaseio.com",
  projectId: "marry-15ccc",
  storageBucket: "marry-15ccc.firebasestorage.app",
  messagingSenderId: "88902830597",
  appId: "1:88902830597:web:c094709f33fc44b40e2a6c"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // 방명록 데이터 읽기
        const entriesList = document.getElementById('guestbook-entries');
        const dbRef = ref(database);
        get(child(dbRef, "guestbook")).then((snapshot) => {
            entriesList.innerHTML = '';
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const entry = childSnapshot.val();
                    const li = document.createElement('li');
                    li.textContent = `${entry.name}: ${entry.message}`;
                    entriesList.appendChild(li);
                });
            } else {
                console.log("No data available");
            }
        }).catch((error) => {
            console.error(error);
        });

        // 방명록 데이터 추가
        const form = document.getElementById('guestbook-form');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value.trim();
            const message = document.getElementById('message').value.trim();
            if (name && message) {
                const newEntryRef = ref(database, 'guestbook/' + Date.now());  // 고유 ID 생성
                set(newEntryRef, {
                    name: name,
                    message: message
                }).then(() => {
                    form.reset();
                    alert("방명록이 추가되었습니다!");
                }).catch((error) => {
                    console.error(error);
                    alert("방명록 추가 실패");
                });
            }
        });
    </script>
</body>
</html>
